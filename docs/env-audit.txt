# Environment Variable Audit

This document enumerates every environment variable reference in the codebase and clarifies whether it is required, optional, or context-specific. All values must be real; placeholders and silent defaults have been removed from the application code.

## Google Generative AI
- `GOOGLE_API_KEY` (required) — Enables Google Gemini requests in `app/api/ask-audio/route.ts`, `app/api/session/[id]/intro/route.ts`, and the diagnostics endpoints.
- `GOOGLE_MODEL` (required) — Primary model name resolved by `lib/google.ts` for audio and intro flows. Invalid or blank entries throw descriptive errors.
- `GOOGLE_DIAGNOSTICS_MODEL` (optional override) — Preferred model for `/api/diagnostics/google`. Falls back to `GOOGLE_MODEL` when provided.
- `PROVIDER` (required) — Must be set to `google` for audio capture; enforced in `app/api/ask-audio/route.ts`.

## OpenAI Platform
- `OPENAI_API_KEY` (required) — Used by `lib/ai.ts`, `lib/openaiTts.ts`, and `/api/diagnostics/openai`. The diagnostics route now rejects requests when this key is missing.
- `OPENAI_DIAGNOSTICS_MODEL` (required) — Explicit model for the OpenAI diagnostics check. The route no longer assumes a fallback name.

## Email & Notifications
- `MAIL_FROM` (required) — Sender address for summary emails (`lib/email.ts`). Missing or blank values throw errors.
- `ENABLE_SESSION_EMAILS` (optional) — Feature flag interpreted in `lib/email.ts` with explicit diagnostic logging.
- `RESEND_API_KEY` / `SENDGRID_API_KEY` (optional) — Provider credentials for summary delivery. Diagnostic logs record which provider is used.
- `DEFAULT_NOTIFY_EMAIL` (required) — Server default email validated in `lib/default-notify-email.server.ts`.
- `NEXT_PUBLIC_DEFAULT_NOTIFY_EMAIL` (required in client builds) — Enforced in `lib/default-notify-email.client.ts`.

## Supabase Storage
- `STORAGE_MODE` (required) — Controls whether the runtime uses Supabase or the in-memory fallback. Validated by `utils/blob-env.ts` and logged during initialization.
- `SUPABASE_URL` (required) — Base URL for Supabase REST calls. Missing values block `/api/diagnostics/storage` immediately.
- `SUPABASE_SERVICE_ROLE_KEY` (required) — Authentication token for Supabase storage operations. Short or missing values are rejected by `lib/blob.ts`.
- `SUPABASE_STORAGE_BUCKET` (required) — Bucket name for transcript and manifest persistence.
- `SUPABASE_ANON_KEY` (optional) — Enables browser-based Supabase access when present; the API logs a warning if omitted.

## Deployment Metadata & Analytics
- `NEXT_PUBLIC_SITE_URL`, `NEXT_PUBLIC_DEPLOYMENT_URL` — Client-facing diagnostics metadata surfaced on `/diagnostics`.
- `VERCEL`, `VERCEL_ENV`, `VERCEL_DEPLOYMENT_ID`, `VERCEL_PROJECT_ID`, `VERCEL_PROJECT_NAME`, `VERCEL_ORG_ID`, `VERCEL_URL`, `VERCEL_BRANCH_URL`, `VERCEL_PROJECT_PRODUCTION_URL`, `VERCEL_REGION`, `RENDER_GIT_COMMIT`, `RENDER_GIT_COMMIT_MESSAGE`, `COMMIT_REF`, `COMMIT_MESSAGE`, `GIT_COMMIT_SHA`, `GIT_COMMIT_MESSAGE`, `GIT_COMMIT_TIMESTAMP`, `GITHUB_REPOSITORY`, `NEXT_PUBLIC_GITHUB_REPOSITORY`, `NEXT_PUBLIC_GIT_COMMIT_SHA`, `NEXT_PUBLIC_GIT_COMMIT_MESSAGE`, `NEXT_PUBLIC_GIT_COMMIT_TIMESTAMP`, `NEXT_PUBLIC_GIT_REPO_OWNER`, `NEXT_PUBLIC_GIT_REPO_SLUG`, `GIT_REPO_OWNER`, `GIT_REPO_SLUG`, `DEPLOY_CREATED_AT`, `DEPLOY_ID`, `DEPLOY_URL`, `DEPLOY_PRIME_URL`, `URL` — Deployment provenance identifiers used by `app/layout.tsx`, diagnostics APIs, and UI summaries.
- `NODE_ENV`, `NEXT_RUNTIME`, `CI` — Execution context flags referenced in diagnostics and build tooling.

## Serverless Function Context
- `AWS_REGION`, `AWS_DEFAULT_REGION`, `AWS_LAMBDA_FUNCTION_NAME`, `VERCEL` — Surface environment metadata in `/api/diagnostics/tues`.

## Testing & Tooling
- `PLAYWRIGHT_TEST_BASE_URL` — Overrides the base URL for Playwright E2E tests.

## GitHub Automation
- `GITHUB_API_URL` (required) — Base URL for GitHub REST requests used by `scripts/create-pr.mjs`. The script aborts when the value is missing or a placeholder.
- `GITHUB_TOKEN` (required) — Personal access token or workflow token for authenticated GitHub API calls.
- `GIT_REMOTE_NAME` (required) — Remote alias pushed by `scripts/create-pr.mjs`. Must point to the upstream repository; placeholder names are rejected.
- `GIT_REPO_NAME` (required) — Repository slug used when opening or updating pull requests.
- `GIT_REPO_OWNER` (required) — Repository owner or organization in GitHub.
- `PR_BASE` (required) — Base branch name targeted by the pull request.
- `PR_BODY` (required) — Markdown body supplied to GitHub when creating or updating the PR.
- `PR_HEAD` (required) — Head branch name pushed to GitHub.
- `PR_TITLE` (required) — Title supplied to the GitHub pull request.
- `PR_DRAFT` (optional) — When set to `true`, the pull request is marked as a draft.

Each variable is now validated or logged with explicit diagnostics so that missing values are caught immediately during runtime.
